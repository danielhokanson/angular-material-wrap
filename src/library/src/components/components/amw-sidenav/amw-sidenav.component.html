<!-- Sidenav Toggle Button -->
@if (showToggle) {
  <amw-button
    #toggleButton
    variant="icon"
    [icon]="toggleButtonIcon"
    class="amw-sidenav__toggle"
    [class.amw-sidenav__toggle--mobile]="isMobile"
    [class.amw-sidenav__toggle--tablet]="isTablet"
    [class.amw-sidenav__toggle--desktop]="isDesktop"
    [disabled]="isDisabled"
    [attr.aria-label]="toggleButtonText"
    [amwTooltip]="toggleButtonText"
    (click)="toggleSidenav()">
  </amw-button>
}

<!-- Sidenav Container -->
<mat-sidenav-container
  class="amw-sidenav__container"
  [class.amw-sidenav__container--mobile]="isMobile"
  [class.amw-sidenav__container--tablet]="isTablet"
  [class.amw-sidenav__container--desktop]="isDesktop"
  [class.amw-sidenav__container--responsive]="isResponsive"
  [class.amw-sidenav__container--disabled]="isDisabled">

  <!-- Sidenav -->
  <mat-sidenav
    #sidenav
    [class]="getSidenavClasses()"
    [mode]="sidenavMode"
    [opened]="opened"
    [disableClose]="disableClose"
    [fixedInViewport]="fixedInViewport"
    [autoFocus]="autoFocus"
    [position]="position"
    [style.width]="sidenavWidth"
    [style.min-width]="config.minWidth"
    [style.max-width]="config.maxWidth"
    (openedChange)="onSidenavOpenedChange($event)">

    <!-- Sidenav Header -->
    @if (headerTemplate || showClose) {
      <div class="amw-sidenav__header">
        @if (headerTemplate) {
          <ng-container *ngTemplateOutlet="headerTemplate"></ng-container>
        } @else {
          <div class="amw-sidenav__header-content">
            <div class="amw-sidenav__header-title">
              <ng-content select="[slot=header]"></ng-content>
            </div>
            @if (showClose) {
              <amw-button
                variant="icon"
                [icon]="closeButtonIcon"
                class="amw-sidenav__close"
                [disabled]="isDisabled"
                [attr.aria-label]="closeButtonText"
                [amwTooltip]="closeButtonText"
                (click)="closeSidenav()">
              </amw-button>
            }
          </div>
        }
      </div>
    }

    <!-- Sidenav Content -->
    <div class="amw-sidenav__content">
      <!-- Navigation Items -->
      <mat-nav-list class="amw-sidenav__nav-list">
        @for (item of items; track trackByItem($index, item)) {
          <!-- Regular Navigation Item -->
          @if (!item.children || item.children.length === 0) {
            <mat-list-item
              class="amw-sidenav__list-item"
              [class]="getItemClasses(item)"
              [disabled]="item.disabled"
              [amwTooltip]="item.tooltip"
              [routerLink]="item.route"
              (click)="onItemClick(item, $event)">
              @if (item.icon) {
                <mat-icon
                  matListItemIcon
                  class="amw-sidenav__item-icon">
                  {{ item.icon }}
                </mat-icon>
              }
              <span matListItemTitle class="amw-sidenav__item-label">
                {{ item.label }}
              </span>
              @if (item.badge) {
                <span
                  matBadge
                  [matBadge]="item.badge"
                  [matBadgeColor]="getBadgeColor(item.badgeColor)"
                  class="amw-sidenav__item-badge">
                </span>
              }
            </mat-list-item>
          }
          <!-- Nested Navigation Item -->
          @if (item.children && item.children.length > 0) {
            <mat-expansion-panel
              class="amw-sidenav__expansion-panel"
              [class.amw-sidenav__expansion-panel--active]="item.active"
              [class.amw-sidenav__expansion-panel--disabled]="item.disabled"
              [expanded]="item.expanded"
              [disabled]="item.disabled"
              (openedChange)="onExpansionChange(item, $event)">
              <mat-expansion-panel-header class="amw-sidenav__expansion-header">
                <mat-panel-title class="amw-sidenav__expansion-title">
                  @if (item.icon) {
                    <mat-icon
                      class="amw-sidenav__item-icon">
                      {{ item.icon }}
                    </mat-icon>
                  }
                  <span class="amw-sidenav__item-label">
                    {{ item.label }}
                  </span>
                  @if (item.badge) {
                    <span
                      matBadge
                      [matBadge]="item.badge"
                      [matBadgeColor]="getBadgeColor(item.badgeColor)"
                      class="amw-sidenav__item-badge">
                    </span>
                  }
                </mat-panel-title>
              </mat-expansion-panel-header>
              <!-- Nested Items -->
              <mat-nav-list class="amw-sidenav__nested-list">
                @for (child of item.children; track trackByItem($index, child)) {
                  <mat-list-item
                    class="amw-sidenav__nested-item"
                    [class]="getItemClasses(child)"
                    [disabled]="child.disabled"
                    [amwTooltip]="child.tooltip"
                    [routerLink]="child.route"
                    (click)="onItemClick(child, $event)">
                    @if (child.icon) {
                      <mat-icon
                        matListItemIcon
                        class="amw-sidenav__item-icon">
                        {{ child.icon }}
                      </mat-icon>
                    }
                    <span matListItemTitle class="amw-sidenav__item-label">
                      {{ child.label }}
                    </span>
                    @if (child.badge) {
                      <span
                        matBadge
                        [matBadge]="child.badge"
                        [matBadgeColor]="getBadgeColor(child.badgeColor)"
                        class="amw-sidenav__item-badge">
                      </span>
                    }
                  </mat-list-item>
                }
              </mat-nav-list>
            </mat-expansion-panel>
          }
        }
      </mat-nav-list>

      <!-- Custom Content -->
      <div class="amw-sidenav__custom-content">
        <ng-content select="[slot=content]"></ng-content>
      </div>
    </div>

    <!-- Sidenav Footer -->
    @if (footerTemplate) {
      <div class="amw-sidenav__footer">
        <ng-container *ngTemplateOutlet="footerTemplate"></ng-container>
      </div>
    }
  </mat-sidenav>

  <!-- Main Content -->
  <mat-sidenav-content class="amw-sidenav__main-content">
    <ng-content></ng-content>
  </mat-sidenav-content>
</mat-sidenav-container>
