<div class="amw-stepper"
     [class.amw-stepper--vertical]="currentConfig().orientation === 'vertical'"
     [class.amw-stepper--horizontal]="currentConfig().orientation === 'horizontal'"
     [class.amw-stepper--linear]="currentConfig().linear"
     [class.amw-stepper--disabled]="disabled()"
     [attr.data-current-step]="currentStep()"
     [attr.data-total-steps]="steps().length">

  <!-- Stepper Header -->
  <div class="amw-stepper__header" *ngIf="currentConfig().showLabels || currentConfig().showIcons">
    <div class="amw-stepper__progress"
         [style.width.%]="getProgress()"
         [attr.data-progress]="getProgress()">
    </div>

    <div class="amw-stepper__steps">
      <div *ngFor="let step of steps(); let i = index" 
           class="amw-stepper__step"
           [class.amw-stepper__step--active]="isStepActive(i)"
           [class.amw-stepper__step--completed]="isStepCompleted(i)"
           [class.amw-stepper__step--disabled]="step.isDisabled"
           [class.amw-stepper__step--optional]="step.isOptional"
           [class.amw-stepper__step--accessible]="isStepAccessible(i)"
           [attr.data-step-index]="i"
           (click)="goToStep(i)">
        
        <!-- Step Icon -->
        <div class="amw-stepper__step-icon" *ngIf="currentConfig().showIcons">
          <amw-icon *ngIf="step.icon && !isStepCompleted(i)" [name]="step.icon"></amw-icon>
          <amw-icon *ngIf="isStepCompleted(i)" name="check"></amw-icon>
          <span *ngIf="!step.icon && !isStepCompleted(i)" class="amw-stepper__step-number">{{ i + 1 }}</span>
        </div>

        <!-- Step Content -->
        <div class="amw-stepper__step-content">
          <div class="amw-stepper__step-label" *ngIf="currentConfig().showLabels">
            {{ step.label }}
            <span *ngIf="step.isOptional" class="amw-stepper__step-optional">(Optional)</span>
          </div>
          <div class="amw-stepper__step-description" *ngIf="currentConfig().showDescriptions && step.description">
            {{ step.description }}
          </div>
        </div>

        <!-- Step Status Indicator -->
        <div class="amw-stepper__step-status">
          <amw-icon *ngIf="isStepCompleted(i)" name="check" class="amw-stepper__step-check"></amw-icon>
          <amw-icon *ngIf="step.isValid === false" name="error" class="amw-stepper__step-error"></amw-icon>
        </div>
      </div>
    </div>
  </div>

  <!-- Stepper Content -->
  <div class="amw-stepper__content">
    <div class="amw-stepper__step-panel"
         *ngFor="let step of steps(); let i = index"
         [class.amw-stepper__step-panel--active]="isStepActive(i)"
         [class.amw-stepper__step-panel--completed]="isStepCompleted(i)"
         [attr.data-step-index]="i">

      <!-- Step Content -->
      <div class="amw-stepper__step-body" *ngIf="isStepActive(i)">
        <div class="amw-stepper__step-title">
          <h3>{{ step.label }}</h3>
          <p *ngIf="step.description">{{ step.description }}</p>
        </div>

        <div class="amw-stepper__step-main">
          <ng-content [ngSwitch]="i">
            <ng-container *ngFor="let stepContent of steps(); let j = index">
              <ng-container *ngSwitchCase="j">
                <div *ngIf="stepContent.content" [innerHTML]="stepContent.content"></div>
              </ng-container>
            </ng-container>
          </ng-content>
        </div>
      </div>
    </div>
  </div>

  <!-- Stepper Navigation -->
  <div class="amw-stepper__navigation" *ngIf="currentConfig().showNavigation && !isCompleting()">
    <div class="amw-stepper__nav-buttons">
      <!-- Previous Button -->
      <amw-button appearance="text"
              icon="arrow_back"
              iconPosition="left"
              class="amw-stepper__nav-button amw-stepper__nav-button--previous"
              [disabled]="!canGoBack() || disabled()"
              (click)="previousStep()">
        Previous
      </amw-button>

      <!-- Next Button -->
      <amw-button appearance="text"
              icon="arrow_forward"
              iconPosition="right"
              class="amw-stepper__nav-button amw-stepper__nav-button--next"
              [disabled]="!canGoNext() || disabled()"
              (click)="nextStep()">
        Next
      </amw-button>

      <!-- Complete Button -->
      <amw-button appearance="elevated"
              icon="check"
              iconPosition="left"
              color="primary"
              class="amw-stepper__nav-button amw-stepper__nav-button--complete"
              [disabled]="!canComplete() || disabled()"
              (click)="completeStepper()"
              *ngIf="currentConfig().showCompletion && currentStep() === steps().length - 1">
        Complete
      </amw-button>
    </div>

    <!-- Stepper Progress -->
    <div class="amw-stepper__progress-info">
      <span class="amw-stepper__progress-text">
        Step {{ currentStep() + 1 }} of {{ steps().length }}
      </span>
      <div class="amw-stepper__progress-bar">
        <div class="amw-stepper__progress-fill"
             [style.width.%]="getProgress()">
        </div>
      </div>
    </div>
  </div>

  <!-- Stepper Completion -->
  <div class="amw-stepper__completion" *ngIf="isCompleting()">
    <div class="amw-stepper__completion-content">
      <amw-icon name="check_circle" class="amw-stepper__completion-icon"></amw-icon>
      <h3>Stepper Completed!</h3>
      <p>All steps have been completed successfully.</p>
      <amw-button appearance="text" (click)="resetStepper()">
        Start Over
      </amw-button>
    </div>
  </div>
</div>
