<mat-card 
  [class]="cardClasses"
  [style]="cardStyles"
  [attr.aria-disabled]="disabled"
  [attr.aria-busy]="loading">
  
  <!-- Clickable wrapper -->
  <div 
    *ngIf="clickable"
    (click)="onCardClick()"
    class="amw-card__ripple-container"
    role="button"
    tabindex="0">
    
    <!-- Card Image -->
    <img 
      *ngIf="hasImage && imagePosition === 'top'"
      mat-card-image
      [src]="image"
      [alt]="imageAlt"
      [class]="imageClasses">
    
    <!-- Card Header -->
    <mat-card-header *ngIf="hasHeader">
      <ng-container [ngTemplateOutlet]="headerTemplate" *ngIf="headerTemplate; else defaultHeader"></ng-container>
      
      <ng-template #defaultHeader>
        <div mat-card-avatar *ngIf="headerIcon" class="amw-card__avatar">
          <mat-icon>{{ headerIcon }}</mat-icon>
        </div>
        <mat-card-title>{{ headerTitle }}</mat-card-title>
        <mat-card-subtitle *ngIf="headerSubtitle">{{ headerSubtitle }}</mat-card-subtitle>
      </ng-template>
    </mat-card-header>
    
    <!-- Card Content -->
    <mat-card-content *ngIf="hasContent">
      <ng-container [ngTemplateOutlet]="contentTemplate" *ngIf="contentTemplate; else defaultContent"></ng-container>
      
      <ng-template #defaultContent>
        <p class="amw-card__content-text">{{ content }}</p>
      </ng-template>
    </mat-card-content>
    
    <!-- Card Image (bottom) -->
    <img 
      *ngIf="hasImage && imagePosition === 'bottom'"
      mat-card-image
      [src]="image"
      [alt]="imageAlt"
      [class]="imageClasses">
    
    <!-- Card Actions -->
    <mat-card-actions *ngIf="hasActions" [align]="actionAlignment">
      <ng-container [ngTemplateOutlet]="actionTemplate" *ngIf="actionTemplate; else defaultActions"></ng-container>
      
      <ng-template #defaultActions>
        <button 
          *ngFor="let action of actions; let i = index"
          mat-button
          [color]="action.color || 'primary'"
          [disabled]="action.disabled || disabled || loading"
          (click)="onActionClick(action, i, $event)"
          class="amw-card__action">
          <mat-icon *ngIf="action.icon" class="amw-card__action-icon">{{ action.icon }}</mat-icon>
          {{ action.label }}
        </button>
      </ng-template>
    </mat-card-actions>
    
    <!-- Card Footer -->
    <mat-card-footer *ngIf="hasFooter">
      <ng-container [ngTemplateOutlet]="footerTemplate" *ngIf="footerTemplate; else defaultFooter"></ng-container>
      
      <ng-template #defaultFooter>
        <p class="amw-card__footer-text">{{ footerContent }}</p>
      </ng-template>
    </mat-card-footer>
    
  </div>
  
  <!-- Non-clickable content -->
  <ng-container *ngIf="!clickable">
    <!-- Card Image -->
    <img 
      *ngIf="hasImage && imagePosition === 'top'"
      mat-card-image
      [src]="image"
      [alt]="imageAlt"
      [class]="imageClasses">
    
    <!-- Card Header -->
    <mat-card-header *ngIf="hasHeader">
      <ng-container [ngTemplateOutlet]="headerTemplate" *ngIf="headerTemplate; else defaultHeader"></ng-container>
      
      <ng-template #defaultHeader>
        <div mat-card-avatar *ngIf="headerIcon" class="amw-card__avatar">
          <mat-icon>{{ headerIcon }}</mat-icon>
        </div>
        <mat-card-title>{{ headerTitle }}</mat-card-title>
        <mat-card-subtitle *ngIf="headerSubtitle">{{ headerSubtitle }}</mat-card-subtitle>
      </ng-template>
    </mat-card-header>
    
    <!-- Card Content -->
    <mat-card-content *ngIf="hasContent">
      <ng-container [ngTemplateOutlet]="contentTemplate" *ngIf="contentTemplate; else defaultContent"></ng-container>
      
      <ng-template #defaultContent>
        <p class="amw-card__content-text">{{ content }}</p>
      </ng-template>
    </mat-card-content>
    
    <!-- Card Image (bottom) -->
    <img 
      *ngIf="hasImage && imagePosition === 'bottom'"
      mat-card-image
      [src]="image"
      [alt]="imageAlt"
      [class]="imageClasses">
    
    <!-- Card Actions -->
    <mat-card-actions *ngIf="hasActions" [align]="actionAlignment">
      <ng-container [ngTemplateOutlet]="actionTemplate" *ngIf="actionTemplate; else defaultActions"></ng-container>
      
      <ng-template #defaultActions>
        <button 
          *ngFor="let action of actions; let i = index"
          mat-button
          [color]="action.color || 'primary'"
          [disabled]="action.disabled || disabled || loading"
          (click)="onActionClick(action, i, $event)"
          class="amw-card__action">
          <mat-icon *ngIf="action.icon" class="amw-card__action-icon">{{ action.icon }}</mat-icon>
          {{ action.label }}
        </button>
      </ng-template>
    </mat-card-actions>
    
    <!-- Card Footer -->
    <mat-card-footer *ngIf="hasFooter">
      <ng-container [ngTemplateOutlet]="footerTemplate" *ngIf="footerTemplate; else defaultFooter"></ng-container>
      
      <ng-template #defaultFooter>
        <p class="amw-card__footer-text">{{ footerContent }}</p>
      </ng-template>
    </mat-card-footer>
  </ng-container>
  
  <!-- Loading Overlay -->
  <div *ngIf="loading" class="amw-card__loading">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Loading...</p>
  </div>
</mat-card>