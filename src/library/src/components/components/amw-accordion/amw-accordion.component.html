<div class="amw-accordion"
  [class.amw-accordion--disabled]="disabled"
  [class.amw-accordion--multi-expand]="currentConfig.multiExpand"
  [attr.data-expanded-count]="getExpandedCount()"
  [attr.data-total-panels]="panels.length">

  <!-- Accordion Header -->
  @if (currentConfig.showExpandCollapseAll) {
    <div class="amw-accordion__header">
      <div class="amw-accordion__header-content">
        <h3 class="amw-accordion__header-title">Accordion</h3>
        <div class="amw-accordion__header-actions">
          <amw-button
            appearance="text"
            icon="expand_more"
            iconPosition="left"
            (click)="expandAll()"
            [disabled]="areAllExpanded() || disabled">
            Expand All
          </amw-button>
          <amw-button
            appearance="text"
            icon="expand_less"
            iconPosition="left"
            (click)="collapseAll()"
            [disabled]="areAllCollapsed() || disabled">
            Collapse All
          </amw-button>
        </div>
      </div>
    </div>
  }

  <!-- Accordion Panels -->
  <div class="amw-accordion__panels">
    <mat-accordion class="amw-accordion__mat-accordion"
      [multi]="currentConfig.multiExpand">

      @for (panel of panels; track panel; let i = $index) {
        <mat-expansion-panel
          class="amw-accordion__panel"
          [class.amw-accordion__panel--expanded]="isPanelExpanded(i)"
          [class.amw-accordion__panel--disabled]="isPanelDisabled(i)"
          [class.amw-accordion__panel--invalid]="!isPanelValid(i)"
          [expanded]="isPanelExpanded(i)"
          [disabled]="isPanelDisabled(i)"
          (opened)="expandPanel(i)"
          (closed)="collapsePanel(i)"
          [attr.data-panel-index]="i">
          <!-- Panel Header -->
          <mat-expansion-panel-header class="amw-accordion__panel-header">
            <div class="amw-accordion__panel-header-content">
              <!-- Panel Icon -->
              @if (currentConfig.showIcons && panel.icon) {
                <amw-icon
                  [name]="panel.icon"
                  class="amw-accordion__panel-icon">
                </amw-icon>
              }
              <!-- Panel Title -->
              <div class="amw-accordion__panel-title">
                <h4 class="amw-accordion__panel-title-text">{{ panel.title }}</h4>
                @if (currentConfig.showDescriptions && panel.description) {
                  <p
                    class="amw-accordion__panel-description">
                    {{ panel.description }}
                  </p>
                }
              </div>
              <!-- Panel Badge -->
              @if (currentConfig.showBadges && hasPanelBadge(i)) {
                <span
                  class="amw-accordion__panel-badge"
                  [style.background-color]="panel.badgeColor || 'var(--mat-sys-error, #f44336)'">
                  {{ getPanelBadgeCount(i) }}
                </span>
              }
            </div>
          </mat-expansion-panel-header>
          <!-- Panel Content -->
          <div class="amw-accordion__panel-content">
            <div class="amw-accordion__panel-body">
              <!-- Panel Actions -->
              @if (currentConfig.showPanelActions) {
                <div class="amw-accordion__panel-actions">
                  <amw-button
                                        [icon]="isPanelExpanded(i) ? 'expand_less' : 'expand_more'"
                    (click)="togglePanel(i)"
                    [disabled]="isPanelDisabled(i)">
                  </amw-button>
                </div>
              }
              <!-- Panel Main Content -->
              <div class="amw-accordion__panel-main">
                <div class="amw-accordion__panel-text" [innerHTML]="panel.content">
                </div>
              </div>
            </div>
          </div>
        </mat-expansion-panel>
      }
    </mat-accordion>
  </div>

  <!-- Empty State -->
  @if (panels.length === 0) {
    <div class="amw-accordion__empty">
      <div class="amw-accordion__empty-content">
        <amw-icon name="expand_more" class="amw-accordion__empty-icon"></amw-icon>
        <h3>No panels available</h3>
        <p>Add some panels to get started</p>
      </div>
    </div>
  }
</div>
