<div #triggerRef class="amw-popover__trigger" [class.amw-popover__trigger--disabled]="disabled()"
  [attr.aria-expanded]="opened()" [attr.aria-haspopup]="true" [attr.aria-controls]="actualPopoverId()"
  [attr.aria-describedby]="opened() ? actualPopoverId() : null" [attr.tabindex]="disabled() ? -1 : 0"
  (click)="onTriggerClick($event)"
  (mouseenter)="onTriggerMouseEnter($event)"
  (mouseleave)="onTriggerMouseLeave($event)"
  (focus)="onTriggerFocus($event)"
  (blur)="onTriggerBlur($event)"
  (keydown)="onTriggerKeyDown($event)">

  <!-- Custom Trigger Template -->
  @if (resolvedTriggerTemplate()) {
    <ng-container [ngTemplateOutlet]="resolvedTriggerTemplate()!"></ng-container>
  } @else {
    <amw-button appearance="text"
      [icon]="triggerIcon()"
      [iconPosition]="'left'"
      class="amw-popover__trigger-button"
      [disabled]="disabled()">
      {{ triggerText() }}
    </amw-button>
  }
</div>

<!-- Popover Content Template for Overlay -->
<ng-template #contentRef>
  <div [id]="actualPopoverId()" class="amw-popover__popover" [class.amw-popover__popover--visible]="opened()"
    [class.amw-popover__popover--small]="size() === 'small'" [class.amw-popover__popover--medium]="size() === 'medium'"
    [class.amw-popover__popover--large]="size() === 'large'" [class.amw-popover__popover--extra-large]="size() === 'extra-large'" [class.amw-popover__popover--with-arrow]="showArrow()"
    [class.amw-popover__popover--with-header]="showHeader()" [class.amw-popover__popover--with-footer]="showFooter()"
    [class.amw-popover__popover--with-scrollbar]="scrollable()" [class.amw-popover__popover--disabled]="disabled()"
    [attr.role]="'dialog'" [attr.aria-hidden]="!opened()" [attr.aria-labelledby]="headerTitle() ? actualPopoverId() + '-title' : null"
    [attr.aria-describedby]="resolvedContentTemplate() ? actualPopoverId() + '-content' : null">

    <!-- Arrows rendered before bubble-content so bubble paints on top, covering inner half -->
    @if (showArrow() && (position() === 'bottom' || position() === 'bottom-left' || position() === 'bottom-right')) {
      <div class="amw-popover__arrow amw-popover__arrow--up"></div>
    }
    @if (showArrow() && (position() === 'top' || position() === 'top-left' || position() === 'top-right')) {
      <div class="amw-popover__arrow amw-popover__arrow--down"></div>
    }
    @if (showArrow() && (position() === 'right')) {
      <div class="amw-popover__arrow amw-popover__arrow--left"></div>
    }
    @if (showArrow() && (position() === 'left')) {
      <div class="amw-popover__arrow amw-popover__arrow--right"></div>
    }

    <!-- Speech Bubble Content Container -->
    <div class="amw-popover__bubble-content" [attr.data-position]="position()" [attr.data-show-arrow]="showArrow()">
      <!-- Header -->
      @if (showHeader()) {
        <div class="amw-popover__header">
          <div class="amw-popover__header-content">
            <div class="amw-popover__header-text">
              @if (headerTitle()) {
                <h3 class="amw-popover__header-title" [id]="actualPopoverId() + '-title'">{{ headerTitle() }}</h3>
              }
              @if (headerSubtitle()) {
                <p class="amw-popover__header-subtitle">{{ headerSubtitle() }}</p>
              }
            </div>
            @if (showClose()) {
              <amw-button
                appearance="icon"
                [icon]="closeButtonIcon()"
                class="amw-popover__close"
                [ariaLabel]="closeButtonText()"
                (click)="onCloseClick()">
              </amw-button>
            }
          </div>
        </div>
      }

      <!-- Content -->
      <div class="amw-popover__content" [id]="actualPopoverId() + '-content'">
        <!-- Custom Content Template -->
        @if (resolvedContentTemplate()) {
          <ng-container [ngTemplateOutlet]="resolvedContentTemplate()!"></ng-container>
        } @else {
          <div class="amw-popover__default-content">
            <p>{{ content() }}</p>
          </div>
        }

        <!-- Default Content Template -->
      </div>

      <!-- Footer -->
      @if (showFooter()) {
        <div class="amw-popover__footer">
          <p class="amw-popover__footer-text">{{ footerText() }}</p>
        </div>
      }
    </div>
  </div>
</ng-template>
