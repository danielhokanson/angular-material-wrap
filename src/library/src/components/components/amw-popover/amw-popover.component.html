<div #triggerRef class="amw-popover__trigger" [class.amw-popover__trigger--disabled]="isDisabled"
  [attr.aria-expanded]="opened" [attr.aria-haspopup]="true" [attr.aria-controls]="popoverId"
  [attr.aria-describedby]="opened ? popoverId : null" [attr.tabindex]="isDisabled ? -1 : 0">

  <!-- Custom Trigger Template -->
  <ng-container *ngIf="triggerTemplate; else defaultTrigger">
    <ng-container [ngTemplateOutlet]="triggerTemplate"></ng-container>
  </ng-container>

  <!-- Default Trigger Template -->
  <ng-template #defaultTrigger>
    <button mat-button class="amw-popover__trigger-button" [disabled]="isDisabled"
      (click)="onTriggerClick($event)" (mouseenter)="onTriggerMouseEnter($event)" (mouseleave)="onTriggerMouseLeave($event)"
      (focus)="onTriggerFocus($event)" (blur)="onTriggerBlur($event)" (keydown)="onTriggerKeyDown($event)">
      <mat-icon *ngIf="triggerIcon">{{ triggerIcon }}</mat-icon>
      {{ triggerText }}
    </button>
  </ng-template>
</div>

<!-- Popover Content Template for Overlay -->
<ng-template #contentRef>
  <div [id]="popoverId" class="amw-popover__popover" [class.amw-popover__popover--visible]="opened"
    [class.amw-popover__popover--small]="size === 'small'" [class.amw-popover__popover--medium]="size === 'medium'"
    [class.amw-popover__popover--large]="size === 'large'" [class.amw-popover__popover--with-arrow]="showArrow"
    [class.amw-popover__popover--with-header]="showHeader" [class.amw-popover__popover--with-footer]="showFooter"
    [class.amw-popover__popover--with-scrollbar]="scrollable" [class.amw-popover__popover--disabled]="isDisabled"
    [attr.role]="'dialog'" [attr.aria-hidden]="!opened" [attr.aria-labelledby]="headerTitle ? popoverId + '-title' : null"
    [attr.aria-describedby]="contentTemplate ? popoverId + '-content' : null">

    <!-- Speech Bubble Content Container -->
    <div class="amw-popover__bubble-content" [attr.data-position]="position" [attr.data-show-arrow]="showArrow">

      <!-- Arrow pointing up (when popover is below trigger) -->
      <div *ngIf="showArrow && (position === 'bottom' || position === 'bottom-left' || position === 'bottom-right')" 
           class="amw-popover__arrow amw-popover__arrow--up"></div>

      <!-- Arrow pointing down (when popover is above trigger) -->
      <div *ngIf="showArrow && (position === 'top' || position === 'top-left' || position === 'top-right')" 
           class="amw-popover__arrow amw-popover__arrow--down"></div>

      <!-- Arrow pointing left (when popover is to the right of trigger) -->
      <div *ngIf="showArrow && (position === 'right')" 
           class="amw-popover__arrow amw-popover__arrow--left"></div>

      <!-- Arrow pointing right (when popover is to the left of trigger) -->
      <div *ngIf="showArrow && (position === 'left')" 
           class="amw-popover__arrow amw-popover__arrow--right"></div>

      <!-- Header -->
      <div *ngIf="showHeader" class="amw-popover__header">
        <div class="amw-popover__header-content">
          <div class="amw-popover__header-text">
            <h3 *ngIf="headerTitle" class="amw-popover__header-title" [id]="popoverId + '-title'">{{ headerTitle }}</h3>
            <p *ngIf="headerSubtitle" class="amw-popover__header-subtitle">{{ headerSubtitle }}</p>
          </div>
          
          <button *ngIf="showClose" mat-icon-button class="amw-popover__close" [attr.aria-label]="closeButtonText"
            (click)="onCloseClick()">
            <mat-icon>{{ closeButtonIcon }}</mat-icon>
          </button>
        </div>
      </div>

      <!-- Content -->
      <div class="amw-popover__content" [id]="popoverId + '-content'">
        <!-- Custom Content Template -->
        <ng-container *ngIf="contentTemplate; else defaultContent">
          <ng-container [ngTemplateOutlet]="contentTemplate"></ng-container>
        </ng-container>

        <!-- Default Content Template -->
        <ng-template #defaultContent>
          <div class="amw-popover__default-content">
            <p>{{ content }}</p>
          </div>
        </ng-template>
      </div>

      <!-- Footer -->
      <div *ngIf="showFooter" class="amw-popover__footer">
        <p class="amw-popover__footer-text">{{ footerText }}</p>
      </div>
    </div>
  </div>
</ng-template>
