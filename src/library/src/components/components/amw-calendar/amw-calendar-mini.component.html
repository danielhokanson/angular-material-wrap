<div class="amw-calendar-mini"
  [class]="internalConfig.cssClass"
  [class.amw-calendar-mini--loading]="loading()"
  [class.amw-calendar-mini--disabled]="disabled()"
  [class.amw-calendar-mini--compact]="compactMode"
  [class.amw-calendar-mini--week-view]="showWeekViewInternal">

  <!-- Loading Spinner -->
  @if (loading()) {
    <div class="amw-calendar-mini__loading">
      <amw-progress-spinner [diameter]="24"></amw-progress-spinner>
    </div>
  }

  <!-- Header -->
  @if (showNavigation()) {
    <div class="amw-calendar-mini__header">
      <!-- Navigation Controls -->
      <div class="amw-calendar-mini__navigation">
        <amw-button
                    icon="chevron_left"
          (click)="navigatePrevious()"
          [disabled]="disabled()"
          amwTooltip="Previous">
        </amw-button>
        <amw-button
          appearance="text"
          (click)="navigateToday()"
          [disabled]="disabled()"
          amwTooltip="Today">
          Today
        </amw-button>
        <amw-button
                    icon="chevron_right"
          (click)="navigateNext()"
          [disabled]="disabled()"
          amwTooltip="Next">
        </amw-button>
      </div>
      <!-- Current Date/Period Display -->
      <div class="amw-calendar-mini__current-period">
        @if (!showWeekViewInternal) {
          <h3>
            {{ getFormattedDate(selectedDate, 'medium') }}
          </h3>
        }
        @if (showWeekViewInternal) {
          <h3>
            {{ getCurrentWeekRange() }}
          </h3>
        }
      </div>
      <!-- Week View Toggle -->
      <div class="amw-calendar-mini__view-toggle">
        <amw-button
                    [icon]="showWeekViewInternal ? 'view_day' : 'view_week'"
          (click)="toggleWeekView()"
          [disabled]="disabled()"
          [amwTooltip]="showWeekViewInternal ? 'Show single day' : 'Show week view'">
        </amw-button>
      </div>
    </div>
  }

  <!-- Content -->
  <div class="amw-calendar-mini__content">

    <!-- Single Day View -->
    @if (!showWeekViewInternal) {
      <div class="amw-calendar-mini__day-view">
        <mat-card class="amw-calendar-mini__day-card">
          <mat-card-header>
            <mat-card-title>
              {{ getFormattedDate(selectedDate, 'long') }}
            </mat-card-title>
            <mat-card-subtitle>
              {{ getEventsForDate(selectedDate).length }} event{{ getEventsForDate(selectedDate).length !== 1 ? 's' : '' }}
            </mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <!-- Events List -->
            <div class="amw-calendar-mini__events-list">
              @for (event of getEventsForDateLimited(selectedDate); track event) {
                <div
                  class="amw-calendar-mini__event"
                  [class]="getMiniEventClasses(event).join(' ')"
                  [style.border-left-color]="getEventColor(event)"
                  (click)="onMiniEventClick(event)"
                  (dblclick)="onMiniEventDoubleClick(event)">
                  <div class="amw-calendar-mini__event-content">
                    <div class="amw-calendar-mini__event-title">
                      {{ getEventDisplayTextMini(event) }}
                    </div>
                    @if (event.description && !compactMode) {
                      <div
                        class="amw-calendar-mini__event-description">
                        {{ event.description }}
                      </div>
                    }
                    <div class="amw-calendar-mini__event-time">
                      {{ getMiniEventTime(event) }}
                    </div>
                  </div>
                  <div class="amw-calendar-mini__event-actions">
                    @if (isEventEditable(event)) {
                      <amw-button
                                                icon="edit"
                        (click)="editEvent(event)"
                        amwTooltip="Edit">
                      </amw-button>
                    }
                    @if (isEventDeletable(event)) {
                      <amw-button
                                                icon="delete"
                        (click)="deleteEvent(event)"
                        amwTooltip="Delete">
                      </amw-button>
                    }
                    <amw-button
                                            icon="info"
                      (click)="onEventDetails(event)"
                      amwTooltip="Details">
                    </amw-button>
                  </div>
                </div>
              }
              <!-- Show More Button -->
              @if (showMoreButton() && getRemainingEventsCount(selectedDate) > 0) {
                <div
                  class="amw-calendar-mini__show-more">
                  <amw-button
                    appearance="text"
                    (click)="onShowMoreClick(selectedDate)"
                    [disabled]="disabled()">
                    +{{ getRemainingEventsCount(selectedDate) }} more
                  </amw-button>
                </div>
              }
              <!-- No Events Message -->
              @if (getEventsForDate(selectedDate).length === 0) {
                <div
                  class="amw-calendar-mini__no-events">
                  <mat-icon>event_available</mat-icon>
                  <p>No events scheduled</p>
                </div>
              }
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    }

    <!-- Week View -->
    @if (showWeekViewInternal) {
      <div class="amw-calendar-mini__week-view">
        <div class="amw-calendar-mini__week-grid">
          @for (date of weekDays; track date) {
            <div
              class="amw-calendar-mini__week-day"
              [class]="getMiniDayClasses(date).join(' ')"
              (click)="onDayClick(date)"
              (dblclick)="onDayDoubleClick(date)">
              <!-- Day Header -->
              <div class="amw-calendar-mini__day-header">
                <div class="amw-calendar-mini__day-name">
                  {{ getDayOfWeekName(date) }}
                </div>
                <div class="amw-calendar-mini__day-date">
                  {{ date.getDate() }}
                </div>
              </div>
              <!-- Day Events -->
              <div class="amw-calendar-mini__day-events">
                @for (event of getEventsForDateLimited(date); track event) {
                  <div
                    class="amw-calendar-mini__event"
                    [class]="getMiniEventClasses(event).join(' ')"
                    [style.border-left-color]="getEventColor(event)"
                    (click)="onMiniEventClick(event)"
                    (dblclick)="onMiniEventDoubleClick(event)">
                    <div class="amw-calendar-mini__event-content">
                      <div class="amw-calendar-mini__event-title">
                        {{ getEventDisplayTextMini(event) }}
                      </div>
                      @if (!event.allDay && !compactMode) {
                        <div
                          class="amw-calendar-mini__event-time">
                          {{ getFormattedTime(event.start) }}
                        </div>
                      }
                    </div>
                    <div class="amw-calendar-mini__event-actions">
                      @if (isEventEditable(event)) {
                        <amw-button
                                                    icon="edit"
                          (click)="editEvent(event)"
                          amwTooltip="Edit">
                        </amw-button>
                      }
                      @if (isEventDeletable(event)) {
                        <amw-button
                                                    icon="delete"
                          (click)="deleteEvent(event)"
                          amwTooltip="Delete">
                        </amw-button>
                      }
                      <amw-button
                                                icon="info"
                        (click)="onEventDetails(event)"
                        amwTooltip="Details">
                      </amw-button>
                    </div>
                  </div>
                }
                <!-- Show More Button -->
                @if (showMoreButton() && getRemainingEventsCount(date) > 0) {
                  <div
                    class="amw-calendar-mini__show-more">
                    <amw-button
                      appearance="text"
                      (click)="onShowMoreClick(date)"
                      [disabled]="disabled()">
                      +{{ getRemainingEventsCount(date) }}
                    </amw-button>
                  </div>
                }
              </div>
            </div>
          }
        </div>
      </div>
    }
  </div>
</div>
