<div class="amw-list-page" [ngClass]="currentConfig.customClasses" [ngStyle]="currentConfig.customStyles">
  <!-- Header -->
  <div class="amw-list-page__header">
    <div class="amw-list-page__header-content">
      <div class="amw-list-page__header-text">
        <h1 class="amw-list-page__title">{{ currentConfig.title }}</h1>
        @if (currentConfig.subtitle) {
          <p class="amw-list-page__subtitle">{{ currentConfig.subtitle }}</p>
        }
      </div>

      <div class="amw-list-page__header-actions">
        <amw-button variant="icon" icon="refresh" (click)="onRefresh()" amwTooltip="Refresh">
        </amw-button>
        <amw-button variant="icon" icon="download" (click)="onExport()" amwTooltip="Export">
        </amw-button>
      </div>
    </div>
  </div>

  <!-- Search and Filters -->
  @if (currentConfig.showSearch || currentConfig.showFilters) {
    <div class="amw-list-page__controls">
      @if (currentConfig.showSearch) {
        <div class="amw-list-page__search">
          <amw-input
            label="Search"
            name="listSearchQuery"
            [(ngModel)]="searchQuery"
            (keyup.enter)="onSearch()"
            placeholder="Search..."
            appearance="outline">
            <mat-icon matSuffix>search</mat-icon>
          </amw-input>
          <amw-button variant="elevated" color="primary" (click)="onSearch()">Search</amw-button>
        </div>
      }
      @if (currentConfig.showFilters && currentConfig.filters && currentConfig.filters.length > 0) {
        <div class="amw-list-page__filters">
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>filter_list</mat-icon>
                Filters
                @if (hasActiveFilters()) {
                  <span class="amw-list-page__filter-count">
                    ({{ getActiveFilterCount() }})
                  </span>
                }
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="amw-list-page__filters-content">
              <div class="amw-list-page__filters-grid">
                @for (filter of currentConfig.filters; track filter) {
                  <div class="amw-list-page__filter-field">
                    @if (filter.type === 'text') {
                      <amw-input
                        [label]="filter.label"
                        name="listFilter_{{ filter.key }}"
                        [(ngModel)]="currentFilters[filter.key]"
                        [placeholder]="filter.placeholder || ''"
                        appearance="outline">
                      </amw-input>
                    }
                    @if (filter.type === 'select') {
                      <amw-select
                        [label]="filter.label"
                        [(ngModel)]="currentFilters[filter.key]"
                        [options]="filter.options || []"
                        appearance="outline">
                      </amw-select>
                    }
                  </div>
                }
              </div>
              <div class="amw-list-page__filters-actions">
                <amw-button variant="text" (click)="onFilterChange()">Apply Filters</amw-button>
                <amw-button variant="text" (click)="clearFilters()">Clear All</amw-button>
              </div>
            </div>
          </mat-expansion-panel>
        </div>
      }
    </div>
  }

  <!-- Bulk Actions -->
  @if (currentConfig.showBulkActions && selectedItems.size > 0) {
    <div class="amw-list-page__bulk-actions">
      <div class="amw-list-page__bulk-actions-content">
        <span class="amw-list-page__bulk-actions-text">
          {{ selectedItems.size }} item(s) selected
        </span>
        <div class="amw-list-page__bulk-actions-buttons">
          @for (action of currentConfig.bulkActions; track action) {
            <amw-button
              variant="text"
              [icon]="action.icon"
              [iconPosition]="action.icon ? 'left' : 'left'"
              [color]="action.color || 'primary'"
              (click)="onBulkAction(action)">
              {{ action.label }}
            </amw-button>
          }
        </div>
      </div>
    </div>
  }

  <!-- Data Table -->
  <div class="amw-list-page__table-container">
    <table mat-table [dataSource]="currentData.items" class="amw-list-page__table">
      <!-- Selection Column -->
      @if (currentConfig.showBulkActions) {
        <ng-container matColumnDef="select">
          <th mat-header-cell *matHeaderCellDef>
            <amw-checkbox [checked]="isAllSelected()"
              [indeterminate]="isIndeterminate()"
              (change)="onSelectAll(!!$event)">
            </amw-checkbox>
          </th>
          <td mat-cell *matCellDef="let row">
            <amw-checkbox [checked]="isSelected(row)"
              (change)="onItemSelect(row, !!$event)">
            </amw-checkbox>
          </td>
        </ng-container>
      }

      <!-- Data Columns -->
      @for (column of currentConfig.columns; track column) {
        <ng-container [matColumnDef]="column.key">
          <th mat-header-cell *matHeaderCellDef
            [mat-sort-header]="isColumnSortable(column.key) ? column.key : ''">
            {{ column.title }}
          </th>
          <td mat-cell *matCellDef="let row">
            {{ row[column.key] }}
          </td>
        </ng-container>
      }

      <!-- Actions Column -->
      @if (currentConfig.customActions && currentConfig.customActions.length > 0) {
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let row">
            @for (action of currentConfig.customActions; track action) {
              <amw-button
                variant="icon"
                [icon]="action.icon"
                (click)="onActionClick(action.key, row)"
                [amwTooltip]="action.label">
              </amw-button>
            }
          </td>
        </ng-container>
      }

      <tr mat-header-row *matHeaderRowDef="getDisplayedColumns()"></tr>
      <tr mat-row *matRowDef="let row; columns: getDisplayedColumns()"></tr>
    </table>

    <!-- Loading State -->
    @if (loading) {
      <div class="amw-list-page__loading">
        <amw-progress-spinner [diameter]="40"></amw-progress-spinner>
        <p>Loading data...</p>
      </div>
    }

    <!-- Error State -->
    @if (error && !loading) {
      <div class="amw-list-page__error">
        <mat-icon>error</mat-icon>
        <p>{{ error }}</p>
        <amw-button variant="elevated" color="primary" (click)="onRefresh()">Retry</amw-button>
      </div>
    }

    <!-- Empty State -->
    @if (!loading && !error && currentData.items.length === 0) {
      <div class="amw-list-page__empty">
        <mat-icon>inbox</mat-icon>
        <p>No data available</p>
      </div>
    }
  </div>

  <!-- Pagination -->
  @if (!loading && !error && currentData.totalCount > 0) {
    <mat-paginator
      [length]="currentData.totalCount"
      [pageIndex]="currentData.pageIndex"
      [pageSize]="currentData.pageSize"
      [pageSizeOptions]="[5, 10, 25, 50, 100]"
      (page)="onPageChange($event)">
    </mat-paginator>
  }
</div>