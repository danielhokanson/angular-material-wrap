<div class="amw-list-page" [ngClass]="currentConfig.customClasses" [ngStyle]="currentConfig.customStyles">
  <!-- Header -->
  <div class="amw-list-page__header">
    <div class="amw-list-page__header-content">
      <div class="amw-list-page__header-text">
        <h1 class="amw-list-page__title">{{ currentConfig.title }}</h1>
        <p class="amw-list-page__subtitle" *ngIf="currentConfig.subtitle">{{ currentConfig.subtitle }}</p>
      </div>
      
      <div class="amw-list-page__header-actions">
        <button mat-icon-button (click)="onRefresh()" matTooltip="Refresh">
          <mat-icon>refresh</mat-icon>
        </button>
        <button mat-icon-button (click)="onExport()" matTooltip="Export">
          <mat-icon>download</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Search and Filters -->
  <div class="amw-list-page__controls" *ngIf="currentConfig.showSearch || currentConfig.showFilters">
    <div class="amw-list-page__search" *ngIf="currentConfig.showSearch">
      <mat-form-field appearance="outline">
        <mat-label>Search</mat-label>
        <input matInput 
               name="listSearchQuery"
               [(ngModel)]="searchQuery" 
               (keyup.enter)="onSearch()" 
               placeholder="Search...">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
      <button mat-raised-button color="primary" (click)="onSearch()">Search</button>
    </div>

    <div class="amw-list-page__filters" *ngIf="currentConfig.showFilters && currentConfig.filters && currentConfig.filters.length > 0">
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>
            <mat-icon>filter_list</mat-icon>
            Filters
            <span *ngIf="hasActiveFilters()" class="amw-list-page__filter-count">
              ({{ getActiveFilterCount() }})
            </span>
          </mat-panel-title>
        </mat-expansion-panel-header>
        
        <div class="amw-list-page__filters-content">
          <div class="amw-list-page__filters-grid">
            <div *ngFor="let filter of currentConfig.filters" class="amw-list-page__filter-field">
              <mat-form-field appearance="outline" *ngIf="filter.type === 'text'">
                <mat-label>{{ filter.label }}</mat-label>
                <input matInput 
                       name="listFilter_{{ filter.key }}"
                       [(ngModel)]="currentFilters[filter.key]" 
                       [placeholder]="filter.placeholder || ''">
              </mat-form-field>
              
              <mat-form-field appearance="outline" *ngIf="filter.type === 'select'">
                <mat-label>{{ filter.label }}</mat-label>
                <mat-select [(ngModel)]="currentFilters[filter.key]">
                  <mat-option *ngFor="let option of filter.options" [value]="option.value">
                    {{ option.label }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
          
          <div class="amw-list-page__filters-actions">
            <button mat-button (click)="onFilterChange()">Apply Filters</button>
            <button mat-button (click)="clearFilters()">Clear All</button>
          </div>
        </div>
      </mat-expansion-panel>
    </div>
  </div>

  <!-- Bulk Actions -->
  <div class="amw-list-page__bulk-actions" *ngIf="currentConfig.showBulkActions && selectedItems.size > 0">
    <div class="amw-list-page__bulk-actions-content">
      <span class="amw-list-page__bulk-actions-text">
        {{ selectedItems.size }} item(s) selected
      </span>
      <div class="amw-list-page__bulk-actions-buttons">
        <button *ngFor="let action of currentConfig.bulkActions" 
                mat-button 
                [color]="action.color || 'primary'"
                (click)="onBulkAction(action)">
          <mat-icon *ngIf="action.icon">{{ action.icon }}</mat-icon>
          {{ action.label }}
        </button>
      </div>
    </div>
  </div>

  <!-- Data Table -->
  <div class="amw-list-page__table-container">
    <table mat-table [dataSource]="currentData.items" class="amw-list-page__table">
      <!-- Selection Column -->
      <ng-container matColumnDef="select" *ngIf="currentConfig.showBulkActions">
        <th mat-header-cell *matHeaderCellDef>
          <mat-checkbox [checked]="isAllSelected()"
                        [indeterminate]="isIndeterminate()"
                        (change)="onSelectAll($event.checked)">
          </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row">
          <mat-checkbox [checked]="isSelected(row)"
                        (change)="onItemSelect(row, $event.checked)">
          </mat-checkbox>
        </td>
      </ng-container>

      <!-- Data Columns -->
      <ng-container *ngFor="let column of currentConfig.columns" [matColumnDef]="column.key">
        <th mat-header-cell *matHeaderCellDef 
            [mat-sort-header]="isColumnSortable(column.key) ? column.key : ''">
          {{ column.title }}
        </th>
        <td mat-cell *matCellDef="let row">
          {{ row[column.key] }}
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions" *ngIf="currentConfig.customActions && currentConfig.customActions.length > 0">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let row">
          <button *ngFor="let action of currentConfig.customActions" 
                  mat-icon-button 
                  (click)="onActionClick(action.key, row)"
                  [matTooltip]="action.label">
            <mat-icon>{{ action.icon }}</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="getDisplayedColumns()"></tr>
      <tr mat-row *matRowDef="let row; columns: getDisplayedColumns()"></tr>
    </table>

    <!-- Loading State -->
    <div class="amw-list-page__loading" *ngIf="loading">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Loading data...</p>
    </div>

    <!-- Error State -->
    <div class="amw-list-page__error" *ngIf="error && !loading">
      <mat-icon>error</mat-icon>
      <p>{{ error }}</p>
      <button mat-raised-button color="primary" (click)="onRefresh()">Retry</button>
    </div>

    <!-- Empty State -->
    <div class="amw-list-page__empty" *ngIf="!loading && !error && currentData.items.length === 0">
      <mat-icon>inbox</mat-icon>
      <p>No data available</p>
    </div>
  </div>

  <!-- Pagination -->
  <mat-paginator *ngIf="!loading && !error && currentData.totalCount > 0"
                  [length]="currentData.totalCount"
                  [pageIndex]="currentData.pageIndex"
                  [pageSize]="currentData.pageSize"
                  [pageSizeOptions]="[5, 10, 25, 50, 100]"
                  (page)="onPageChange($event)">
  </mat-paginator>
</div>