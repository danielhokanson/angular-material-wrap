<div class="amw-workflow-page" [ngClass]="currentConfig.customClasses" [ngStyle]="currentConfig.customStyles">
  <!-- Header -->
  <div class="amw-workflow-page__header">
    <div class="amw-workflow-page__header-content">
      <div class="amw-workflow-page__header-text">
        <h1 class="amw-workflow-page__title">{{ currentConfig.title }}</h1>
        @if (currentConfig.subtitle) {
          <p class="amw-workflow-page__subtitle">{{ currentConfig.subtitle }}</p>
        }
      </div>

      <div class="amw-workflow-page__header-actions">
        @if (currentConfig.showCancelButton) {
          <amw-button appearance="elevated" icon="cancel" iconPosition="left" (click)="onCancelWorkflow()">
            Cancel
          </amw-button>
        }
        @if (currentConfig.showSaveButton) {
          <amw-button appearance="elevated" icon="save" iconPosition="left" (click)="onSaveWorkflow()">
            Save
          </amw-button>
        }
        @if (currentConfig.showResetButton) {
          <amw-button appearance="elevated" icon="refresh" iconPosition="left" (click)="onResetWorkflow()">
            Reset
          </amw-button>
        }
      </div>
    </div>
  </div>

  <!-- Progress Bar -->
  <div class="amw-workflow-page__progress">
    <amw-progress-bar
      mode="determinate"
      [progressValue]="getProgressPercentage()"
      class="amw-workflow-page__progress-bar">
    </amw-progress-bar>
    <div class="amw-workflow-page__progress-text">
      Step {{ currentData.currentStep + 1 }} of {{ currentData.totalSteps }}
      ({{ Math.round(getProgressPercentage()) }}% complete)
    </div>
  </div>

  <!-- Loading State -->
  @if (loading) {
    <div class="amw-workflow-page__loading">
      <amw-progress-spinner [diameter]="40"></amw-progress-spinner>
      <p>Loading workflow...</p>
    </div>
  }

  <!-- Error State -->
  @if (error && !loading) {
    <div class="amw-workflow-page__error">
      <amw-icon name="error"></amw-icon>
      <p>{{ error }}</p>
      <amw-button appearance="elevated" color="primary" (click)="loadWorkflow()">Retry</amw-button>
    </div>
  }

  <!-- Workflow Content -->
  @if (!loading && !error) {
    <div class="amw-workflow-page__content">
      <!-- Steps Navigation -->
      <div class="amw-workflow-page__steps">
        <div class="amw-workflow-page__steps-container">
          @for (step of currentConfig.steps; track step; let i = $index) {
            <div
              class="amw-workflow-page__step"
              [class.amw-workflow-page__step--completed]="isStepCompleted(i)"
              [class.amw-workflow-page__step--current]="isStepCurrent(i)"
              [class.amw-workflow-page__step--pending]="!isStepCompleted(i) && !isStepCurrent(i)"
              [class.amw-workflow-page__step--accessible]="isStepAccessible(i)"
              (click)="onStepClick(i)">
              <div class="amw-workflow-page__step-indicator">
                @if (isStepCompleted(i)) {
                  <amw-icon name="check"></amw-icon>
                }
                @if (!isStepCompleted(i)) {
                  <span>{{ i + 1 }}</span>
                }
              </div>
              <div class="amw-workflow-page__step-content">
                <h3 class="amw-workflow-page__step-title">{{ step.title }}</h3>
                @if (step.description) {
                  <p class="amw-workflow-page__step-description">{{ step.description }}</p>
                }
              </div>
            </div>
          }
        </div>
      </div>
      <!-- Current Step Content -->
      <div class="amw-workflow-page__step-content">
        @if (getCurrentStep()) {
          <amw-card
            class="amw-workflow-page__step-card"
            [headerTitle]="getCurrentStep()?.title || ''"
            [headerSubtitle]="getCurrentStep()?.description || ''">
            <ng-template #cardContent>
              <div class="amw-workflow-page__step-form">
                <!-- Step content will be rendered here -->
                <p>Step content for: {{ getCurrentStep()?.title }}</p>
                <p>This is where the step-specific form or content would be rendered.</p>
              </div>
            </ng-template>
          </amw-card>
        }
      </div>
      <!-- Navigation Buttons -->
      <div class="amw-workflow-page__navigation">
        <div class="amw-workflow-page__navigation-buttons">
          @if (canGoPrevious()) {
            <amw-button appearance="elevated"
              icon="arrow_back"
              iconPosition="left"
              (click)="onPreviousStep()"
              [disabled]="!canGoPrevious()">
              Previous
            </amw-button>
          }
          @if (canGoNext()) {
            <amw-button appearance="elevated"
              icon="arrow_forward"
              iconPosition="right"
              color="primary"
              (click)="onNextStep()"
              [disabled]="!canGoNext()">
              Next
            </amw-button>
          }
          @if (isWorkflowComplete()) {
            <amw-button appearance="elevated"
              icon="check"
              iconPosition="left"
              color="primary"
              (click)="onCompleteWorkflow()"
              [disabled]="saving">
              {{ saving ? 'Completing...' : 'Complete Workflow' }}
            </amw-button>
          }
        </div>
      </div>
    </div>
  }
</div>