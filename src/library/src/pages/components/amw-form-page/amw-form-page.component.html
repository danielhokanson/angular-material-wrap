<div class="amw-form-page" [ngClass]="currentConfig.customClasses" [ngStyle]="currentConfig.customStyles">
  <!-- Header -->
  <div class="amw-form-page__header">
    <div class="amw-form-page__header-content">
      <div class="amw-form-page__header-text">
        <h1 class="amw-form-page__title">{{ currentConfig.title }}</h1>
        @if (currentConfig.subtitle) {
          <p class="amw-form-page__subtitle">{{ currentConfig.subtitle }}</p>
        }
      </div>

      <div class="amw-form-page__header-actions">
        @if (currentConfig.showSaveButton) {
          <amw-button appearance="elevated" icon="save" iconPosition="left" color="primary" (click)="onSave()"
            [disabled]="!form.valid || saving">
            {{ saving ? 'Saving...' : 'Save' }}
          </amw-button>
        }
        @if (currentConfig.showCancelButton) {
          <amw-button appearance="elevated" icon="cancel" iconPosition="left" (click)="onCancel()">
            Cancel
          </amw-button>
        }
        @if (currentConfig.showResetButton) {
          <amw-button appearance="elevated" icon="refresh" iconPosition="left" (click)="onReset()">
            Reset
          </amw-button>
        }
        @if (currentConfig.showPreviewButton) {
          <amw-button appearance="elevated" icon="preview" iconPosition="left" (click)="onPreview()">
            Preview
          </amw-button>
        }
        @if (currentConfig.showPrintButton) {
          <amw-button appearance="elevated" icon="print" iconPosition="left" (click)="onPrint()">
            Print
          </amw-button>
        }
      </div>
    </div>
  </div>

  <!-- Loading State -->
  @if (loading) {
    <div class="amw-form-page__loading">
      <amw-progress-spinner [diameter]="40"></amw-progress-spinner>
      <p>Loading data...</p>
    </div>
  }

  <!-- Error State -->
  @if (error && !loading) {
    <div class="amw-form-page__error">
      <amw-icon name="error"></amw-icon>
      <p>{{ error }}</p>
      <amw-button appearance="elevated" color="primary" (click)="loadData()">Retry</amw-button>
    </div>
  }

  <!-- Form Content -->
  @if (!loading && !error) {
    <form [formGroup]="form" (ngSubmit)="onSave()" class="amw-form-page__form">
      <div class="amw-form-page__sections">
        @for (section of currentConfig.sections; track section) {
          <amw-card
            class="amw-form-page__section"
            [headerTitle]="section.title"
            [style.display]="isSectionVisible(section) ? 'block' : 'none'">
            <ng-template #cardContent>
              <div class="amw-form-page__fields">
                @for (field of section.fields; track field) {
                  <div
                    class="amw-form-page__field"
                    [style.display]="isFieldVisible(field) ? 'block' : 'none'">
                    <!-- Text Input -->
                    @if (field.type === 'text' || field.type === 'email' || field.type === 'password') {
                      <amw-input
                        [label]="field.label"
                        [formControlName]="field.key"
                        [type]="field.type"
                        [placeholder]="field.placeholder || ''"
                        [maxlength]="field.validation?.maxlength || null"
                        appearance="outline">
                      </amw-input>
                    }
                    <!-- Number Input -->
                    @if (field.type === 'number') {
                      <amw-input
                        [label]="field.label"
                        type="number"
                        [formControlName]="field.key"
                        [placeholder]="field.placeholder || ''"
                        [min]="field.validation?.min || null"
                        [max]="field.validation?.max || null"
                        appearance="outline">
                      </amw-input>
                    }
                    <!-- Textarea -->
                    @if (field.type === 'textarea') {
                      <amw-textarea
                        [label]="field.label"
                        [formControlName]="field.key"
                        [placeholder]="field.placeholder || ''"
                        [maxlength]="field.validation?.maxlength || null"
                        [rows]="4"
                        [hasError]="!!getFieldError(field)"
                        [errorMessage]="getFieldError(field)"
                        appearance="outline">
                      </amw-textarea>
                    }
                    <!-- Select -->
                    @if (field.type === 'select') {
                      <amw-select
                        [label]="field.label"
                        [formControlName]="field.key"
                        [options]="field.options || []"
                        appearance="outline">
                      </amw-select>
                      @if (getFieldError(field)) {
                        <div class="field-error">{{ getFieldError(field) }}</div>
                      }
                    }
                    <!-- Checkbox -->
                    @if (field.type === 'checkbox') {
                      <div class="amw-form-page__checkbox">
                        <amw-checkbox
                          [formControlName]="field.key"
                          [hasError]="!!getFieldError(field)"
                          [errorMessage]="getFieldError(field)">
                          {{ field.label }}
                        </amw-checkbox>
                      </div>
                    }
                    <!-- Radio Group -->
                    @if (field.type === 'radio') {
                      <div class="amw-form-page__radio">
                        <label class="amw-form-page__radio-label">{{ field.label }}</label>
                        <amw-radio-group [formControlName]="field.key">
                          @for (option of field.options; track option) {
                            <amw-radio [radioValue]="option.value">
                              {{ option.label }}
                            </amw-radio>
                          }
                        </amw-radio-group>
                        @if (getFieldError(field)) {
                          <div class="field-error">{{ getFieldError(field) }}</div>
                        }
                      </div>
                    }
                    <!-- Date Picker -->
                    @if (field.type === 'date') {
                      <amw-datepicker
                        [label]="field.label"
                        [formControlName]="field.key"
                        [placeholder]="field.placeholder || ''"
                        appearance="outline">
                      </amw-datepicker>
                    }
                    <!-- Chips -->
                    @if (field.type === 'chips') {
                      <amw-chips
                        [label]="field.label"
                        [chips]="getChipsForField(field)"
                        [placeholder]="'Add new item...'"
                        [removable]="true"
                        [addable]="true"
                        [hasError]="!!getFieldError(field)"
                        [errorMessage]="getFieldError(field)"
                        (chipAdd)="onChipAdd(field, $event)"
                        (chipRemove)="onChipRemove(field, $event)">
                      </amw-chips>
                    }
                  </div>
                }
              </div>
            </ng-template>
          </amw-card>
        }
      </div>
    </form>
  }
</div>