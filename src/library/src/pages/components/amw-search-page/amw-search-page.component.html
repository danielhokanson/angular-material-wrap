<div class="amw-search-page" [ngClass]="currentConfig.customClasses" [ngStyle]="currentConfig.customStyles">
  <!-- Header -->
  <div class="amw-search-page__header">
    <div class="amw-search-page__header-content">
      <div class="amw-search-page__header-text">
        <h1 class="amw-search-page__title">{{ currentConfig.title }}</h1>
        @if (currentConfig.subtitle) {
          <p class="amw-search-page__subtitle">{{ currentConfig.subtitle }}</p>
        }
      </div>
    </div>
  </div>

  <!-- Search Bar -->
  <div class="amw-search-page__search-bar">
    <div class="amw-search-page__search-container">
      <amw-input
        label="Search"
        name="searchQuery"
        [(ngModel)]="searchQuery"
        (keyup.enter)="onSearch()"
        (focus)="onSearchInputFocus()"
        (blur)="onSearchInputBlur()"
        placeholder="Enter search terms..."
        appearance="outline"
        class="amw-search-page__search-field">
        <amw-icon name="search" matSuffix></amw-icon>
      </amw-input>
      <amw-button appearance="elevated" color="primary" (click)="onSearch()">Search</amw-button>
    </div>
  </div>

  <!-- Main Content Layout -->
  <div class="amw-search-page__content">
    <!-- Filter Toggle Button -->
    @if (currentConfig.showAdvancedFilters && currentConfig.searchFields && currentConfig.searchFields.length > 0) {
      <div class="amw-search-page__filter-toggle">
        <amw-button appearance="elevated"
          [icon]="filtersVisible ? 'close' : 'filter_list'"
          iconPosition="left"
          color="primary"
          (click)="toggleFilters()"
          class="amw-search-page__filter-toggle-btn">
          {{ filtersVisible ? 'Hide Filters' : 'Show Filters' }}
        </amw-button>
      </div>
    }

    <!-- Filters Sidebar -->
    @if (currentConfig.showAdvancedFilters && currentConfig.searchFields && currentConfig.searchFields.length > 0 && filtersVisible) {
      <div class="amw-search-page__sidebar"
        [class.amw-search-page__sidebar--visible]="filtersVisible">
        <amw-card class="amw-search-page__filters-card">
          <ng-template #cardHeader>
            <amw-icon name="filter_list"></amw-icon>
            Filters
            <amw-button               icon="close"
              (click)="toggleFilters()"
              class="amw-search-page__close-filters-btn"
              aria-label="Close filters">
            </amw-button>
          </ng-template>
          <ng-template #cardContent>
            <div class="amw-search-page__filters-content">
              @for (field of currentConfig.searchFields; track field) {
                <div
                  class="amw-search-page__filter-field"
                  [style.display]="isFieldVisible(field) ? 'block' : 'none'">
                  @if (field.type === 'text') {
                    <amw-input
                      [label]="field.label"
                      name="searchField_{{ field.key }}"
                      [ngModel]="getFieldValue(field)"
                      (ngModelChange)="setFieldValue(field, $event)"
                      [placeholder]="field.placeholder || ''"
                      appearance="outline"
                      class="amw-search-page__filter-input">
                    </amw-input>
                  }
                  @if (field.type === 'select') {
                    <amw-select
                      [label]="field.label"
                      [ngModel]="getFieldValue(field)"
                      (ngModelChange)="setFieldValue(field, $event)"
                      [options]="field.options || []"
                      appearance="outline"
                      class="amw-search-page__filter-input">
                    </amw-select>
                  }
                  @if (field.type === 'boolean') {
                    <div class="amw-search-page__checkbox">
                      <amw-checkbox [ngModel]="getFieldValue(field)" (ngModelChange)="setFieldValue(field, $event)">
                        {{ field.label }}
                      </amw-checkbox>
                    </div>
                  }
                </div>
              }
              <div class="amw-search-page__filters-actions">
                <amw-button appearance="elevated" color="primary" (click)="onFilterChange()" class="amw-search-page__filter-button">
                  Apply Filters
                </amw-button>
                <amw-button appearance="text" (click)="onClearFilters()" class="amw-search-page__filter-button">
                  Clear All
                </amw-button>
              </div>
            </div>
          </ng-template>
        </amw-card>
      </div>
    }

    <!-- Results Area -->
    <div class="amw-search-page__results-area"
      [class.amw-search-page__results-area--filters-visible]="filtersVisible">

      <!-- Results Header -->
      @if (!loading && !error) {
        <div class="amw-search-page__results-header">
          <div class="amw-search-page__results-info">
            <span>{{ currentData.totalCount }} results found</span>
          </div>
          <div class="amw-search-page__results-controls">
            <!-- Sort Options -->
            @if (currentConfig.showSortOptions && currentConfig.sortOptions) {
              <amw-select
                label="Sort by"
                [(ngModel)]="sortField"
                [options]="currentConfig.sortOptions"
                (ngModelChange)="onSortChange()"
                appearance="outline">
              </amw-select>
            }
            <!-- View Modes -->
            @if (currentConfig.showViewModes && currentConfig.viewModes) {
              <div class="amw-search-page__view-modes">
                @for (mode of currentConfig.viewModes; track mode) {
                  <amw-button
                                        [icon]="mode.icon"
                    [class.amw-search-page__view-mode--active]="viewMode === mode.value"
                    (click)="onViewModeChange(mode.value)"
                    [amwTooltip]="mode.label">
                  </amw-button>
                }
              </div>
            }
          </div>
        </div>
      }

      <!-- Loading State -->
      @if (loading) {
        <div class="amw-search-page__loading">
          <amw-progress-spinner [diameter]="40"></amw-progress-spinner>
          <p>Searching...</p>
        </div>
      }

      <!-- Error State -->
      @if (error && !loading) {
        <div class="amw-search-page__error">
          <amw-icon name="error"></amw-icon>
          <p>{{ error }}</p>
          <amw-button appearance="elevated" color="primary" (click)="onSearch()">Retry</amw-button>
        </div>
      }

      <!-- Results -->
      @if (!loading && !error) {
        <div class="amw-search-page__results">
          <!-- List View -->
          @if (viewMode === 'list') {
            <div class="amw-search-page__results-list">
              @for (result of currentData.results; track result) {
                <amw-card
                  class="amw-search-page__result-card"
                  [clickable]="true"
                  (cardClick)="onResultClick(result)">
                  <ng-template #cardContent>
                    <h3>{{ result.title || result.name || 'Result' }}</h3>
                    <p>{{ result.description || result.summary || 'No description available' }}</p>
                    <div class="amw-search-page__result-meta">
                      @if (result.date) {
                        <span>{{ result.date | date:'medium' }}</span>
                      }
                      @if (result.category) {
                        <span>{{ result.category }}</span>
                      }
                      @if (result.score) {
                        <span>{{ Math.round(result.score * 100) }}% match</span>
                      }
                    </div>
                  </ng-template>
                </amw-card>
              }
            </div>
          }
          <!-- Grid View -->
          @if (viewMode === 'grid') {
            <div class="amw-search-page__results-grid">
              @for (result of currentData.results; track result) {
                <amw-card
                  class="amw-search-page__result-card"
                  [clickable]="true"
                  (cardClick)="onResultClick(result)">
                  <ng-template #cardContent>
                    <h3>{{ result.title || result.name || 'Result' }}</h3>
                    <p>{{ result.description || result.summary || 'No description available' }}</p>
                  </ng-template>
                </amw-card>
              }
            </div>
          }
          <!-- Card View -->
          @if (viewMode === 'card') {
            <div class="amw-search-page__results-cards">
              @for (result of currentData.results; track result) {
                <amw-card
                  class="amw-search-page__result-card"
                  [clickable]="true"
                  (cardClick)="onResultClick(result)"
                  [headerTitle]="result.title || result.name || 'Result'"
                  [headerSubtitle]="result.category || 'Category'">
                  <ng-template #cardContent>
                    <p>{{ result.description || result.summary || 'No description available' }}</p>
                  </ng-template>
                  <ng-template #cardActions>
                    <amw-button appearance="text">View Details</amw-button>
                  </ng-template>
                </amw-card>
              }
            </div>
          }
          <!-- Empty State -->
          @if (currentData.results.length === 0) {
            <div class="amw-search-page__empty">
              <amw-icon name="search_off"></amw-icon>
              <p>No results found</p>
              <amw-button appearance="elevated" color="primary" (click)="onClearFilters()">Clear Filters</amw-button>
            </div>
          }
        </div>
      }
    </div>
  </div>