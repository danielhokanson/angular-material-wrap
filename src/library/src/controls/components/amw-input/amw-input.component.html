<div class="amw-input">
  <mat-form-field
    [appearance]="appearance()"
    [class]="'amw-input__field amw-input--' + size() + ' amw-input--' + appearance()"
    [class.amw-input--error]="hasValidationError"
    [class.amw-input--disabled]="disabled()"
    [class.amw-input--readonly]="readonly()"
    [class.amw-input--with-start-icon]="!!startIcon()"
    [class.amw-input--with-end-icon]="!!endIcon() || canClear || canTogglePassword"
    [class.amw-input--with-character-count]="showCharacterCount()"
    [floatLabel]="label() ? 'always' : 'auto'"
    [hideRequiredMarker]="!required()"
    [class.mat-form-field-invalid]="hasValidationError">

    <!-- Label -->
    @if (label()) {
      <mat-label [innerHTML]="label()"></mat-label>
    }

    <!-- Start Icon -->
    @if (startIcon()) {
      <mat-icon matPrefix class="amw-input__start-icon">{{ startIcon() }}</mat-icon>
    }

    <!-- Prefix Text -->
    @if (prefix()) {
      <span matPrefix class="amw-input__prefix">{{ prefix() }}</span>
    }

    <!-- Input Element -->
    <!-- Signal Forms binding (scenario 3) - Field directive manages most attributes automatically -->
    @if (formField()) {
      <input
        matInput
        [formField]="formField()"
        [type]="inputType"
        [placeholder]="placeholder()"
        [step]="step()"
        [autocomplete]="autocomplete()"
        [autofocus]="autofocus()"
        [id]="id()"
        [attr.tabindex]="tabIndex()"
        [attr.aria-label]="ariaLabel()"
        [attr.aria-labelledby]="ariaLabelledby()"
        [attr.aria-describedby]="ariaDescribedby()"
        (blur)="onBlur($event)"
        (focus)="onFocus($event)"
        (keydown)="onKeydown($event)"
        (keyup)="onKeyup($event)"
        class="amw-input__field">
    } @else {
      <!-- ngModel / Reactive Forms binding (scenarios 1 & 2) -->
      <input
        matInput
        [type]="inputType"
        [placeholder]="placeholder()"
        [disabled]="disabled()"
        [readonly]="readonly()"
        [required]="required()"
        [attr.maxlength]="maxlength()"
        [attr.minlength]="minlength()"
        [max]="max()"
        [min]="min()"
        [step]="step()"
        [pattern]="pattern()"
        [autocomplete]="autocomplete()"
        [autofocus]="autofocus()"
        [name]="name()"
        [id]="id()"
        [attr.tabindex]="tabIndex()"
        [attr.aria-label]="ariaLabel()"
        [attr.aria-labelledby]="ariaLabelledby()"
        [attr.aria-describedby]="ariaDescribedby()"
        [attr.aria-required]="ariaRequired() || required()"
        [attr.aria-invalid]="ariaInvalid() || hasValidationError"
        [value]="value()"
        (input)="onInput($event)"
        (change)="onChangeEvent($event)"
        (blur)="onBlur($event)"
        (focus)="onFocus($event)"
        (keydown)="onKeydown($event)"
        (keyup)="onKeyup($event)"
        class="amw-input__field">
    }

    <!-- Loading Spinner -->
    @if (loading()) {
      <mat-spinner matSuffix [diameter]="20" class="amw-input__spinner"></mat-spinner>
    }

    <!-- Suffix Text -->
    @if (suffix()) {
      <span matSuffix class="amw-input__suffix">{{ suffix() }}</span>
    }

    <!-- End Icon -->
    @if (endIcon()) {
      <mat-icon matSuffix class="amw-input__end-icon">{{ endIcon() }}</mat-icon>
    }

    <!-- Clear Button -->
    @if (canClear) {
      <amw-button
        icon="clear"
        matSuffix
        type="button"
        (buttonClick)="onClear()"
        class="amw-input__clear-button"
        [attr.aria-label]="'Clear input'">
      </amw-button>
    }

    <!-- Password Toggle Button -->
    @if (canTogglePassword) {
      <amw-button
        [icon]="showPassword ? 'visibility_off' : 'visibility'"
        matSuffix
        type="button"
        (buttonClick)="onTogglePassword()"
        class="amw-input__password-toggle"
        [attr.aria-label]="showPassword ? 'Hide password' : 'Show password'">
      </amw-button>
    }

    <!-- Hint Text -->
    @if (hint() && !hasValidationError) {
      <mat-hint class="amw-input__hint">{{ hint() }}</mat-hint>
    }

    <!-- Character Count -->
    @if (showCharacterCount() && !hasValidationError) {
      <mat-hint align="end" class="amw-input__character-count" [class.amw-input__character-count--over-limit]="isOverLimit">
        {{ characterCountText }}
      </mat-hint>
    }

    <!-- Error Message -->
    @if (hasValidationError) {
      <mat-error class="amw-input__error">
        {{ errorText }}
      </mat-error>
    }
  </mat-form-field>
</div>
