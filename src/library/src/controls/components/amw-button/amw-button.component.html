<div class="amw-button" [class.amw-button--bare]="effectiveAppearance() === 'icon'">
  <!-- Common Button Content Template (for standard buttons and extended FAB) -->
  <ng-template #buttonContent>
    <!-- Left Icon -->
    @if (icon() && iconPosition() === 'left' && !loading()) {
      <amw-icon [name]="icon()" class="amw-button__icon amw-button__icon--left"></amw-icon>
    }

    <!-- Loading Spinner -->
    @if (loading()) {
      <amw-progress-spinner class="amw-button__spinner" [diameter]="spinnerSize()" [color]="spinnerColor()">
      </amw-progress-spinner>
    }

    <!-- Button Text -->
    @if (!loading() && !isIconOnly()) {
      <span class="amw-button__text">
        @if (text() && text().trim()) {
          <span [innerHTML]="text()"></span>
        } @else {
          <ng-content></ng-content>
        }
      </span>
    }

    <!-- Right Icon -->
    @if (icon() && iconPosition() === 'right' && !loading()) {
      <amw-icon [name]="icon()" class="amw-button__icon amw-button__icon--right"></amw-icon>
    }
  </ng-template>

  <!-- Icon-Only Content Template (for FABs and icon buttons) -->
  <ng-template #iconOnlyContent>
    <!-- Loading Spinner -->
    @if (loading()) {
      <amw-progress-spinner class="amw-button__spinner" [diameter]="spinnerSize()" [color]="spinnerColor()">
      </amw-progress-spinner>
    }

    <!-- Icon -->
    @if (icon() && !loading()) {
      <amw-icon [name]="icon()" class="amw-button__icon"></amw-icon>
    }
  </ng-template>

  <!-- Standard FAB -->
  @if (isFab() && !isMiniFab() && !isExtendedFab()) {
    <button matFab [type]="type()" [attr.color]="color()" [disabled]="disabled() || loading()"
      [autofocus]="autofocus()" [name]="name()" [attr.form]="form()" [attr.formaction]="formAction()"
      [attr.formmethod]="formMethod()" [attr.formtarget]="formTarget()" [attr.formenctype]="formEnctype()"
      [attr.formnovalidate]="formNoValidate()" [attr.aria-label]="ariaLabel()" [attr.aria-labelledby]="ariaLabelledby()"
      [attr.aria-describedby]="ariaDescribedby()" [attr.tabindex]="tabIndex()" [class]="buttonClasses"
      (click)="onButtonClick($event)" (focus)="onButtonFocus($event)" (blur)="onButtonBlur($event)"
      (mouseenter)="onMouseEnter($event)" (mouseleave)="onMouseLeave($event)" class="amw-button__button">
      <ng-container [ngTemplateOutlet]="iconOnlyContent"></ng-container>
    </button>
  }

  <!-- Mini FAB -->
  @else if (isMiniFab()) {
    <button matMiniFab [type]="type()" [attr.color]="color()" [disabled]="disabled() || loading()"
      [autofocus]="autofocus()" [name]="name()" [attr.form]="form()" [attr.formaction]="formAction()"
      [attr.formmethod]="formMethod()" [attr.formtarget]="formTarget()" [attr.formenctype]="formEnctype()"
      [attr.formnovalidate]="formNoValidate()" [attr.aria-label]="ariaLabel()" [attr.aria-labelledby]="ariaLabelledby()"
      [attr.aria-describedby]="ariaDescribedby()" [attr.tabindex]="tabIndex()" [class]="buttonClasses"
      (click)="onButtonClick($event)" (focus)="onButtonFocus($event)" (blur)="onButtonBlur($event)"
      (mouseenter)="onMouseEnter($event)" (mouseleave)="onMouseLeave($event)" class="amw-button__button">
      <ng-container [ngTemplateOutlet]="iconOnlyContent"></ng-container>
    </button>
  }

  <!-- Extended FAB -->
  @else if (isExtendedFab()) {
    <button matFab extended [type]="type()" [attr.color]="color()" [disabled]="disabled() || loading()"
      [autofocus]="autofocus()" [name]="name()" [attr.form]="form()" [attr.formaction]="formAction()"
      [attr.formmethod]="formMethod()" [attr.formtarget]="formTarget()" [attr.formenctype]="formEnctype()"
      [attr.formnovalidate]="formNoValidate()" [attr.aria-label]="ariaLabel()" [attr.aria-labelledby]="ariaLabelledby()"
      [attr.aria-describedby]="ariaDescribedby()" [attr.tabindex]="tabIndex()" [class]="buttonClasses"
      (click)="onButtonClick($event)" (focus)="onButtonFocus($event)" (blur)="onButtonBlur($event)"
      (mouseenter)="onMouseEnter($event)" (mouseleave)="onMouseLeave($event)" class="amw-button__button">
      <ng-container [ngTemplateOutlet]="buttonContent"></ng-container>
    </button>
  }

  <!-- Bare Icon (appearance="icon") - no button wrapper -->
  @else if (effectiveAppearance() === 'icon') {
    <amw-icon
      [name]="icon()"
      [class]="buttonClasses"
      [attr.role]="'button'"
      [attr.tabindex]="disabled() ? -1 : (tabIndex() ?? 0)"
      [attr.aria-label]="ariaLabel()"
      [attr.aria-disabled]="disabled() || loading()"
      (click)="onButtonClick($event)"
      (focus)="onButtonFocus($event)"
      (blur)="onButtonBlur($event)"
      (mouseenter)="onMouseEnter($event)"
      (mouseleave)="onMouseLeave($event)"
      (keydown.enter)="onBareIconKeydown($event)"
      (keydown.space)="onBareIconKeydown($event)">
    </amw-icon>
  }

  <!-- Icon-Only Button (not FAB) -->
  @else if (isIconOnly()) {
    <button matIconButton [type]="type()" [attr.color]="color()" [disabled]="disabled() || loading()"
      [autofocus]="autofocus()" [name]="name()" [attr.form]="form()" [attr.formaction]="formAction()"
      [attr.formmethod]="formMethod()" [attr.formtarget]="formTarget()" [attr.formenctype]="formEnctype()"
      [attr.formnovalidate]="formNoValidate()" [attr.aria-label]="ariaLabel()" [attr.aria-labelledby]="ariaLabelledby()"
      [attr.aria-describedby]="ariaDescribedby()" [attr.tabindex]="tabIndex()" [class]="buttonClasses"
      (click)="onButtonClick($event)" (focus)="onButtonFocus($event)" (blur)="onButtonBlur($event)"
      (mouseenter)="onMouseEnter($event)" (mouseleave)="onMouseLeave($event)" class="amw-button__button">
      <ng-container [ngTemplateOutlet]="iconOnlyContent"></ng-container>
    </button>
  }

  <!-- Standard Buttons with different styles -->
  @else {
    @switch (effectiveAppearance()) {
      @case ('text') {
        <button matButton [type]="type()" [attr.color]="color()" [disabled]="disabled() || loading()"
          [autofocus]="autofocus()" [name]="name()" [attr.form]="form()" [attr.formaction]="formAction()"
          [attr.formmethod]="formMethod()" [attr.formtarget]="formTarget()" [attr.formenctype]="formEnctype()"
          [attr.formnovalidate]="formNoValidate()" [attr.aria-label]="ariaLabel()" [attr.aria-labelledby]="ariaLabelledby()"
          [attr.aria-describedby]="ariaDescribedby()" [attr.tabindex]="tabIndex()" [class]="buttonClasses"
          (click)="onButtonClick($event)" (focus)="onButtonFocus($event)" (blur)="onButtonBlur($event)"
          (mouseenter)="onMouseEnter($event)" (mouseleave)="onMouseLeave($event)" class="amw-button__button">
          <ng-container [ngTemplateOutlet]="buttonContent"></ng-container>
        </button>
      }
      @case ('elevated') {
        <button matButton="elevated" [type]="type()" [attr.color]="color()" [disabled]="disabled() || loading()"
          [autofocus]="autofocus()" [name]="name()" [attr.form]="form()" [attr.formaction]="formAction()"
          [attr.formmethod]="formMethod()" [attr.formtarget]="formTarget()" [attr.formenctype]="formEnctype()"
          [attr.formnovalidate]="formNoValidate()" [attr.aria-label]="ariaLabel()" [attr.aria-labelledby]="ariaLabelledby()"
          [attr.aria-describedby]="ariaDescribedby()" [attr.tabindex]="tabIndex()" [class]="buttonClasses"
          (click)="onButtonClick($event)" (focus)="onButtonFocus($event)" (blur)="onButtonBlur($event)"
          (mouseenter)="onMouseEnter($event)" (mouseleave)="onMouseLeave($event)" class="amw-button__button">
          <ng-container [ngTemplateOutlet]="buttonContent"></ng-container>
        </button>
      }
      @case ('outlined') {
        <button matButton="outlined" [type]="type()" [attr.color]="color()" [disabled]="disabled() || loading()"
          [autofocus]="autofocus()" [name]="name()" [attr.form]="form()" [attr.formaction]="formAction()"
          [attr.formmethod]="formMethod()" [attr.formtarget]="formTarget()" [attr.formenctype]="formEnctype()"
          [attr.formnovalidate]="formNoValidate()" [attr.aria-label]="ariaLabel()" [attr.aria-labelledby]="ariaLabelledby()"
          [attr.aria-describedby]="ariaDescribedby()" [attr.tabindex]="tabIndex()" [class]="buttonClasses"
          (click)="onButtonClick($event)" (focus)="onButtonFocus($event)" (blur)="onButtonBlur($event)"
          (mouseenter)="onMouseEnter($event)" (mouseleave)="onMouseLeave($event)" class="amw-button__button">
          <ng-container [ngTemplateOutlet]="buttonContent"></ng-container>
        </button>
      }
      @case ('filled') {
        <button matButton="filled" [type]="type()" [attr.color]="color()" [disabled]="disabled() || loading()"
          [autofocus]="autofocus()" [name]="name()" [attr.form]="form()" [attr.formaction]="formAction()"
          [attr.formmethod]="formMethod()" [attr.formtarget]="formTarget()" [attr.formenctype]="formEnctype()"
          [attr.formnovalidate]="formNoValidate()" [attr.aria-label]="ariaLabel()" [attr.aria-labelledby]="ariaLabelledby()"
          [attr.aria-describedby]="ariaDescribedby()" [attr.tabindex]="tabIndex()" [class]="buttonClasses"
          (click)="onButtonClick($event)" (focus)="onButtonFocus($event)" (blur)="onButtonBlur($event)"
          (mouseenter)="onMouseEnter($event)" (mouseleave)="onMouseLeave($event)" class="amw-button__button">
          <ng-container [ngTemplateOutlet]="buttonContent"></ng-container>
        </button>
      }
      @case ('tonal') {
        <button matButton="tonal" [type]="type()" [attr.color]="color()" [disabled]="disabled() || loading()"
          [autofocus]="autofocus()" [name]="name()" [attr.form]="form()" [attr.formaction]="formAction()"
          [attr.formmethod]="formMethod()" [attr.formtarget]="formTarget()" [attr.formenctype]="formEnctype()"
          [attr.formnovalidate]="formNoValidate()" [attr.aria-label]="ariaLabel()" [attr.aria-labelledby]="ariaLabelledby()"
          [attr.aria-describedby]="ariaDescribedby()" [attr.tabindex]="tabIndex()" [class]="buttonClasses"
          (click)="onButtonClick($event)" (focus)="onButtonFocus($event)" (blur)="onButtonBlur($event)"
          (mouseenter)="onMouseEnter($event)" (mouseleave)="onMouseLeave($event)" class="amw-button__button">
          <ng-container [ngTemplateOutlet]="buttonContent"></ng-container>
        </button>
      }
    }
  }
</div>
