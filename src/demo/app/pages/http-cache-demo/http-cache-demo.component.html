<div class="http-cache-demo">
  <div class="http-cache-demo__header">
    <h1>HTTP Cache Interceptor Demo</h1>
    <p>Test the HTTP caching interceptor with configurable timeouts</p>
  </div>

  <div class="http-cache-demo__content">
    <amw-card class="http-cache-demo__card">
      <ng-template #cardHeader>
        <h2>HTTP Cache Interceptor</h2>
        <p class="subtitle">Interactive demo and documentation</p>
      </ng-template>
      <ng-template #cardContent>
    <amw-tabs>
      <!-- Demo Tab -->
      <amw-tab label="Demo" icon="play_arrow">
        <div class="tab-content">
          <amw-card>
            <ng-template #cardHeader>
              <h2>Test Cache Behavior</h2>
              <p class="subtitle">Click buttons multiple times to see caching in action</p>
            </ng-template>
            <ng-template #cardContent>
              <div class="cache-info">
                <div class="chip-list">
                  <span class="chip">
                    <amw-icon name="memory"></amw-icon>
                    Memory: {{ cacheSize }} entries
                  </span>
                  <span class="chip">
                    <amw-icon name="storage"></amw-icon>
                    IndexedDB: {{ totalCacheSize }} entries
                  </span>
                  <span class="chip">
                    <amw-icon name="pie_chart"></amw-icon>
                    Storage: {{ storageUsage }}
                  </span>
                  @if (lastRequestTime !== null) {
                    <span class="chip" [class.cached]="lastRequestTime < 10">
                      <amw-icon name="timer"></amw-icon>
                      Response Time: {{ lastRequestTime.toFixed(2) }}ms
                      @if (lastRequestTime < 10) {
                        <span class="cached-badge">CACHED</span>
                      }
                    </span>
                  }
                </div>
              </div>

              <div class="test-endpoints">
                <h3>Test Endpoints</h3>
                <div class="endpoint-buttons">
                  @for (endpoint of testEndpoints; track endpoint) {
                    <amw-button appearance="elevated"
                      color="primary"
                      (click)="makeRequest(endpoint.url)"
                      [disabled]="loading" icon="http" iconPosition="left">{{ endpoint.label }}</amw-button>
                  }
                </div>
              </div>

              <div class="cache-actions">
                <amw-button appearance="elevated" color="accent" (click)="pruneExpired()" icon="cleaning_services" iconPosition="left">Prune Expired</amw-button>
                <amw-button appearance="elevated" color="warn" (click)="clearCache()" icon="delete_sweep" iconPosition="left">Clear All Cache</amw-button>
              </div>

              @if (loading) {
                <amw-progress-spinner [diameter]="40"></amw-progress-spinner>
              }

              @if (errorMessage) {
                <div class="error-message">
                  <amw-icon name="warning"></amw-icon>
                  <p>{{ errorMessage }}</p>
                </div>
              }

              @if (responseData) {
                <div class="response-data">
                  <h3>Response Data</h3>
                  <pre>{{ responseData | json }}</pre>
                </div>
              }
            </ng-template>
          </amw-card>

          <amw-card>
            <ng-template #cardHeader>
              <h2>Current Cache Configuration</h2>
              <p class="subtitle">From assets/cache-map.json</p>
            </ng-template>
            <ng-template #cardContent>
              <div class="config-list">
                @for (pattern of cacheConfig | keyvalue; track pattern) {
                  <div class="config-item">
                    <amw-icon name="schedule"></amw-icon>
                    <div class="config-details">
                      <span class="config-pattern">{{ pattern.key }}</span>
                      <span class="config-timeout">Timeout: {{ pattern.value }} ms</span>
                    </div>
                  </div>
                }
              </div>
            </ng-template>
          </amw-card>
        </div>
      </amw-tab>

      <!-- Code Tab -->
      <amw-tab label="Code" icon="code">
        <div class="tab-content">
          <div class="code-examples">
            <h3>HTTP Cache Interceptor Code Examples</h3>
            <p>Setup and usage examples for the HTTP caching system.</p>

            <div class="code-example">
              <h4>1. Register the Interceptor</h4>
              <pre><code>{{ codeExamples.basic }}</code></pre>
            </div>

            <div class="code-example">
              <h4>2. Configure Cache Patterns</h4>
              <pre><code>{{ codeExamples.cacheMap }}</code></pre>
            </div>

            <div class="code-example">
              <h4>3. Using AmwHttpCacheService</h4>
              <pre><code>{{ codeExamples.serviceUsage }}</code></pre>
            </div>

            <div class="code-example">
              <h4>4. Using AmwCacheConfigService</h4>
              <pre><code>{{ codeExamples.configUsage }}</code></pre>
            </div>

            <div class="code-example">
              <h4>5. URL Pattern Matching</h4>
              <pre><code>{{ codeExamples.patternMatching }}</code></pre>
            </div>
          </div>

          <amw-card>
            <ng-template #cardHeader>
              <h2>Testing Tips</h2>
            </ng-template>
            <ng-template #cardContent>
              <ul class="tips-list">
                <li><strong>Test Caching:</strong> Click a test endpoint button twice quickly - the second request should be instant (cached)</li>
                <li><strong>Test Expiration:</strong> Wait for the timeout period, then click again - a fresh request will be made</li>
                <li><strong>Network Tab:</strong> Use the browser's Network tab to see which requests actually hit the network</li>
                <li><strong>Console Logging:</strong> Check the console for cache hit/miss logging</li>
                <li><strong>Test Persistence:</strong> Click a button, close the browser, reopen - the cache should still be there</li>
                <li><strong>Test Cross-Tab:</strong> Open two tabs, cache data in one - it's available in the other instantly</li>
                <li><strong>Monitor Storage:</strong> Check the storage usage statistics to see IndexedDB usage</li>
              </ul>
            </ng-template>
          </amw-card>

          <amw-card>
            <ng-template #cardHeader>
              <h2>Features</h2>
            </ng-template>
            <ng-template #cardContent>
              <ul class="features-list">
                <li><strong>Automatic Caching:</strong> GET requests are automatically cached based on URL patterns</li>
                <li><strong>Persistent Storage:</strong> Cache survives browser restarts using IndexedDB</li>
                <li><strong>Cross-Tab Sharing:</strong> Cache is shared between all browser tabs/windows</li>
                <li><strong>Two-Tier Architecture:</strong> Fast in-memory cache (L1) + persistent IndexedDB (L2)</li>
                <li><strong>Large Dataset Support:</strong> IndexedDB can handle 10,000+ records efficiently</li>
                <li><strong>Configurable Timeouts:</strong> Different endpoints can have different cache durations</li>
                <li><strong>Pattern Matching:</strong> Supports placeholders like <code>:id</code>, <code>:param</code>, and <code>*</code></li>
                <li><strong>In-Flight Deduplication:</strong> Prevents duplicate requests to the same endpoint</li>
                <li><strong>Automatic Expiration:</strong> Cached responses expire after the configured timeout</li>
                <li><strong>Storage Monitoring:</strong> Track storage usage and quota</li>
              </ul>
            </ng-template>
          </amw-card>
        </div>
      </amw-tab>

      <!-- API Tab -->
      <amw-tab label="API" icon="description">
        <div class="tab-content">
          <div class="api-section">
            <amw-api-doc
              componentName="AmwHttpCacheService"
              [apiDocumentation]="httpCacheServiceApiDoc"
              description="Service for managing HTTP response caching with two-tier storage (memory + IndexedDB).">
            </amw-api-doc>
          </div>

          <div class="api-section">
            <amw-api-doc
              componentName="AmwCacheConfigService"
              [apiDocumentation]="cacheConfigServiceApiDoc"
              description="Service for loading and querying cache configuration from assets/cache-map.json.">
            </amw-api-doc>
          </div>
        </div>
      </amw-tab>
    </amw-tabs>
      </ng-template>
    </amw-card>
  </div>
</div>
